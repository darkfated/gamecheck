<!DOCTYPE html>
<html lang="ru" style="margin: 0; padding: 0; height: 100%;">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Game Quiz Widget</title>
  <style>
    html, body {
      margin: 0;
      padding: 0;
      font-family: Arial, sans-serif;
      background-color: transparent;
      overflow: hidden;
      height: 100%;
    }
    
    .vue-game-widget {
      font-family: Arial, sans-serif;
      max-width: 100%;
      padding: 15px;
      border-radius: 8px;
      background: linear-gradient(to right, #4a2f80, #3a4780);
      color: #fff;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
      min-height: 450px;
      display: flex;
      flex-direction: column;
    }
    
    h2 {
      text-align: center;
      margin-bottom: 20px;
      font-size: 1.5rem;
    }
    
    .question-container {
      margin-bottom: 30px;
    }
    
    .question {
      font-size: 1.2rem;
      margin-bottom: 15px;
      font-weight: bold;
    }
    
    .options-list {
      list-style-type: none;
      padding: 0;
    }
    
    .option-item {
      padding: 10px 15px;
      background-color: rgba(255, 255, 255, 0.15);
      border-radius: 8px;
      margin-bottom: 10px;
      cursor: pointer;
      transition: all 0.3s ease;
    }
    
    .option-item:hover {
      background-color: rgba(255, 255, 255, 0.25);
      transform: translateY(-2px);
    }
    
    .option-item.selected {
      background-color: rgba(105, 56, 180, 0.8);
      border: 2px solid rgba(255, 255, 255, 0.5);
    }
    
    .option-item.correct {
      background-color: rgba(46, 213, 115, 0.8);
    }
    
    .option-item.incorrect {
      background-color: rgba(255, 71, 87, 0.8);
    }
    
    .controls {
      text-align: center;
      margin-top: 20px;
    }
    
    button {
      background-color: #6938b4;
      color: white;
      border: none;
      padding: 10px 20px;
      font-size: 1rem;
      border-radius: 4px;
      cursor: pointer;
      transition: background-color 0.3s ease;
    }
    
    button:hover {
      background-color: #7d4ccc;
    }
    
    button:disabled {
      background-color: #9d9fb3;
      cursor: not-allowed;
    }
    
    .result {
      text-align: center;
      padding: 15px;
      background-color: rgba(255, 255, 255, 0.2);
      border-radius: 8px;
      margin-top: 20px;
    }
    
    .score {
      font-size: 1.5rem;
      font-weight: bold;
      margin-bottom: 10px;
    }
    
    .feedback {
      font-size: 1.1rem;
    }
    
    .navigation {
      display: flex;
      justify-content: space-between;
      margin-top: 20px;
    }
  </style>
  <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
</head>
<body>
  <div id="app"></div>

  <script>
    // Vue приложение - викторина по играм
    const { createApp, ref, computed } = Vue;
    
    const GameQuizWidget = {
      setup() {
        const currentQuestionIndex = ref(0);
        const selectedOptionIndex = ref(null);
        const showResult = ref(false);
        const userAnswers = ref([]);
        const quizCompleted = ref(false);
        
        // База вопросов для викторины
        const questions = [
          {
            question: "В какой из игр основного персонажа сюжетной линии играл актёр Киану Ривз?",
            options: [
              "Death Stranding", 
              "Cyberpunk 2077", 
              "Grand Theft Auto V", 
              "The Last of Us Part II"
            ],
            correctAnswer: 1 // Индекс правильного ответа (Cyberpunk 2077)
          },
          {
            question: "Какая игра получила титул «Игра года» на The Game Awards 2020?",
            options: [
              "Ghost of Tsushima", 
              "The Last of Us Part II", 
              "DOOM Eternal", 
              "Hades"
            ],
            correctAnswer: 1 // The Last of Us Part II
          },
          {
            question: "В какой игровой вселенной присутствует организация под названием Черный Меза (Black Mesa)?",
            options: [
              "Half-Life", 
              "Resident Evil", 
              "Metal Gear Solid", 
              "BioShock"
            ],
            correctAnswer: 0 // Half-Life
          },
          {
            question: "Какая компания разработала игру Minecraft?",
            options: [
              "Electronic Arts", 
              "Valve", 
              "Mojang Studios", 
              "Blizzard Entertainment"
            ],
            correctAnswer: 2 // Mojang Studios
          },
          {
            question: "Какая игра из серии The Elder Scrolls вышла в 2011 году?",
            options: [
              "The Elder Scrolls III: Morrowind", 
              "The Elder Scrolls IV: Oblivion", 
              "The Elder Scrolls V: Skyrim", 
              "The Elder Scrolls Online"
            ],
            correctAnswer: 2 // The Elder Scrolls V: Skyrim
          }
        ];
        
        const currentQuestion = computed(() => {
          return questions[currentQuestionIndex.value];
        });
        
        const score = computed(() => {
          if (!quizCompleted.value) return 0;
          
          return userAnswers.value.reduce((total, answer, index) => {
            return answer === questions[index].correctAnswer ? total + 1 : total;
          }, 0);
        });
        
        const feedback = computed(() => {
          const maxScore = questions.length;
          const userScore = score.value;
          const percentage = (userScore / maxScore) * 100;
          
          if (percentage === 100) return "Отлично! Ты настоящий знаток видеоигр!";
          if (percentage >= 80) return "Очень хорошо! Ты хорошо разбираешься в играх!";
          if (percentage >= 60) return "Неплохо! Неплохие знания!";
          if (percentage >= 40) return "Можно лучше. Стоит поиграть в больше игр!";
          return "Попробуй еще раз! Игровая индустрия ждет тебя!";
        });
        
        // Функция выбора ответа
        const selectOption = (index) => {
          selectedOptionIndex.value = index;
        };
        
        // Функция перехода к следующему вопросу
        const nextQuestion = () => {
          // Сохраняем ответ пользователя
          userAnswers.value.push(selectedOptionIndex.value);
          
          // Если это был последний вопрос, показываем результат
          if (currentQuestionIndex.value === questions.length - 1) {
            quizCompleted.value = true;
            showResult.value = true;
            
            // Сообщаем родительскому окну о завершении викторины
            notifyParent();
          } else {
            // Иначе переходим к следующему вопросу
            currentQuestionIndex.value++;
            selectedOptionIndex.value = null;
          }
        };
        
        // Сброс викторины
        const resetQuiz = () => {
          currentQuestionIndex.value = 0;
          selectedOptionIndex.value = null;
          showResult.value = false;
          userAnswers.value = [];
          quizCompleted.value = false;
        };
        
        // Сообщаем родительскому окну о результате
        const notifyParent = () => {
          if (window.parent && window.parent !== window) {
            window.parent.postMessage({
              type: 'QUIZ_COMPLETED',
              result: {
                score: score.value,
                totalQuestions: questions.length,
                percentage: (score.value / questions.length) * 100
              }
            }, '*');
          }
        };
        
        return {
          questions,
          currentQuestion,
          currentQuestionIndex,
          selectedOptionIndex,
          showResult,
          userAnswers,
          quizCompleted,
          score,
          feedback,
          selectOption,
          nextQuestion,
          resetQuiz
        };
      },
      template: `
        <div class="vue-game-widget">
          <h2>Викторина по видеоиграм</h2>
          
          <div v-if="!showResult" class="question-container" style="flex-grow: 1;">
            <div class="question">{{ currentQuestionIndex + 1 }}. {{ currentQuestion.question }}</div>
            
            <ul class="options-list">
              <li 
                v-for="(option, index) in currentQuestion.options" 
                :key="index"
                @click="selectOption(index)"
                :class="['option-item', { selected: selectedOptionIndex === index }]"
              >
                {{ option }}
              </li>
            </ul>
            
            <div class="controls">
              <button @click="nextQuestion" :disabled="selectedOptionIndex === null">
                {{ currentQuestionIndex < questions.length - 1 ? 'Следующий вопрос' : 'Завершить викторину' }}
              </button>
            </div>
          </div>
          
          <div v-else class="result" style="flex-grow: 1;">
            <div class="score">Ваш результат: {{ score }} из {{ questions.length }}</div>
            <div class="feedback">{{ feedback }}</div>
            <div class="controls">
              <button @click="resetQuiz">Пройти викторину снова</button>
            </div>
          </div>
        </div>
      `
    };
    
    // Создаем приложение
    const app = createApp(GameQuizWidget);
    
    // Монтируем его
    app.mount('#app');
    
    // Сообщаем родительскому окну, что все готово
    window.addEventListener('load', () => {
      if (window.parent && window.parent !== window) {
        window.parent.postMessage({ type: 'VUE_WIDGET_LOADED' }, '*');
      }
    });
  </script>
</body>
</html> 